{% macro gauge(label, current_pct, limit_label, current_label, fill_class) %}
<div style="margin-bottom:8px;">
  <div style="display:flex; justify-content:space-between; font-size:10px; margin-bottom:2px;">
    <span style="color:var(--text-muted); text-transform:uppercase;">{{ label }}</span>
    <span>
      <span style="font-weight:600; font-family:'JetBrains Mono',monospace;
        color:{{ 'var(--color-negative)' if current_pct >= 95 else ('var(--color-warning)' if current_pct >= 80 else 'var(--text-primary)') }};">
        {{ current_label }}
      </span>
      <span style="color:var(--text-muted);"> / {{ limit_label }}</span>
    </span>
  </div>
  <div class="risk-gauge-bar" style="height:3px;">
    <div class="risk-gauge-fill {{ fill_class }}" style="width:{{ [current_pct, 100] | min }}%"></div>
  </div>
  <div style="font-size:8px; color:var(--text-muted); margin-top:1px;">
    {{ "%.0f" | format(current_pct) }}%
    {% if current_pct >= 95 %}
      <span style="color:var(--color-negative); font-weight:600;">CRITICAL</span>
    {% elif current_pct >= 80 %}
      <span style="color:var(--color-warning);">WARN</span>
    {% endif %}
  </div>
</div>
{% endmacro %}

<div class="card-label">RISK LIMITS <span class="tooltip-wrap info-icon">&#9432;<span class="tooltip-text">Hard risk limits from configuration: daily loss cap, max drawdown, and position size ceiling. Gauges show current usage percentage.</span></span></div>

{% set dl_pct = risk_gauges.daily_loss_pct_used | default(0) %}
{% set dl_class = 'critical' if dl_pct >= 95 else ('warn' if dl_pct >= 80 else 'safe') %}
{{ gauge('MAX DAILY LOSS', dl_pct, risk_gauges.daily_loss_limit | default('-'), risk_gauges.daily_loss_current | default('$0'), dl_class) }}

{% set dd_pct = risk_gauges.drawdown_pct_used | default(0) %}
{% set dd_class = 'critical' if dd_pct >= 95 else ('warn' if dd_pct >= 80 else 'safe') %}
{{ gauge('MAX DRAWDOWN', dd_pct, risk_gauges.drawdown_limit | default('-'), risk_gauges.drawdown_current | default('$0'), dd_class) }}

{% set pos_pct = risk_gauges.position_size_pct_used | default(0) %}
{% set pos_class = 'critical' if pos_pct >= 95 else ('warn' if pos_pct >= 80 else 'safe') %}
{{ gauge('MAX POSITION SIZE', pos_pct, risk_gauges.position_size_limit | default('-'), risk_gauges.position_size_current | default('0%'), pos_class) }}

<div style="font-size:8px; color:var(--text-muted); margin-top:4px;">
  âš  80% WARN Â· ðŸ”´ 95% CRITICAL
  <span style="float:right;">{{ risk_gauges.updated_at | default('â€”') }}</span>
</div>
