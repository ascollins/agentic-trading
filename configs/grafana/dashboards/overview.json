{
  "annotations": { "list": [] },
  "description": "At-a-glance system health, portfolio status, and key metrics. Start here.",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "links": [
    { "title": "Strategy Performance", "url": "/d/strategy-performance", "type": "link", "icon": "bolt", "tooltip": "Deep dive into strategy win rates, profit, and behavior" },
    { "title": "Risk & Governance", "url": "/d/risk-governance", "type": "link", "icon": "shield", "tooltip": "Risk limits, safety controls, and compliance" },
    { "title": "System Health", "url": "/d/system-health", "type": "link", "icon": "heart", "tooltip": "Speed, data feeds, and component status" },
    { "title": "Trader Quality", "url": "/d/trader-quality", "type": "link", "icon": "favorite", "tooltip": "Institutional-grade quality scorecard — strategy grades F to A+" },
    { "title": "Strategy Reference Guide", "url": "/d/strategy-reference", "type": "link", "icon": "book", "tooltip": "How each strategy works" },
    { "title": "Live Narration", "url": "/d/narration-live", "type": "link", "icon": "comment-alt", "tooltip": "Plain-English commentary on decisions" }
  ],
  "panels": [
    {
      "title": "",
      "type": "text",
      "gridPos": { "h": 2, "w": 24, "x": 0, "y": 0 },
      "options": { "content": "# System Health", "mode": "markdown" }
    },
    {
      "title": "Emergency Stop",
      "description": "Kill switch control. When active, all new orders are rejected. Click the button to toggle.",
      "type": "text",
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 2 },
      "options": {
        "mode": "html",
        "content": "<div id=\"ks-panel-o\" style=\"display:flex;align-items:center;justify-content:center;height:100%;gap:12px;padding:0 10px;\">\n  <div id=\"ks-indicator-o\" style=\"flex:1;text-align:center;\">\n    <div id=\"ks-label-o\" style=\"font-size:16px;font-weight:700;\">Loading...</div>\n    <div id=\"ks-sub-o\" style=\"font-size:10px;margin-top:2px;color:#999;\"></div>\n  </div>\n  <button id=\"ks-btn-o\" onclick=\"(async()=>{const b=document.getElementById('ks-btn-o');b.disabled=true;b.style.opacity='0.5';b.textContent='...';const wasActive=b.dataset.active==='true';const action=wasActive?'deactivate':'activate';try{const r=await fetch('http://localhost:8099/actions/kill-switch/'+action,{method:'POST'});if(!r.ok)throw new Error(r.statusText);setTimeout(()=>location.reload(),1500);}catch(e){b.textContent='Error';b.disabled=false;b.style.opacity='1';}})()\" style=\"padding:8px 14px;border:none;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;min-width:110px;transition:all 0.2s;background:#333;color:#ccc;\" data-active=\"false\">Loading...</button>\n</div>\n<script>\n(async function poll(){try{const r=await fetch('http://localhost:9091/api/v1/query?query=trading_kill_switch_active');const d=await r.json();const v=d?.data?.result?.[0]?.value?.[1];const active=v==='1';const lbl=document.getElementById('ks-label-o');const sub=document.getElementById('ks-sub-o');const btn=document.getElementById('ks-btn-o');if(lbl&&btn){btn.dataset.active=String(active);if(active){lbl.textContent='STOPPED';lbl.style.color='#f44336';sub.textContent='All orders blocked';btn.textContent='Resume Trading';btn.style.background='#2e7d32';btn.style.color='#fff';btn.style.boxShadow='0 2px 8px rgba(46,125,50,0.4)';}else{lbl.textContent='ACTIVE';lbl.style.color='#4caf50';sub.textContent='Trading normally';btn.textContent='Emergency Stop';btn.style.background='#c62828';btn.style.color='#fff';btn.style.boxShadow='0 2px 8px rgba(198,40,40,0.4)';}}}catch(e){}setTimeout(poll,5000);})();\n</script>"
      }
    },
    {
      "title": "Portfolio Health",
      "description": "Based on current drawdown. Green = drawdown under 5%. Yellow = 5-10%. Orange = 10-15%. Red = over 15%.",
      "type": "stat",
      "gridPos": { "h": 4, "w": 5, "x": 6, "y": 2 },
      "targets": [
        {
          "expr": "trading_drawdown_pct",
          "legendFormat": "drawdown",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percentunit",
          "thresholds": {
            "steps": [
              { "value": null, "color": "green" },
              { "value": 0.05, "color": "yellow" },
              { "value": 0.10, "color": "orange" },
              { "value": 0.15, "color": "red" }
            ]
          },
          "mappings": [
            { "type": "range", "options": { "from": 0, "to": 0.05, "result": { "text": "Healthy", "color": "green" } } },
            { "type": "range", "options": { "from": 0.05, "to": 0.10, "result": { "text": "Caution", "color": "yellow" } } },
            { "type": "range", "options": { "from": 0.10, "to": 0.15, "result": { "text": "Warning", "color": "orange" } } },
            { "type": "range", "options": { "from": 0.15, "to": 1, "result": { "text": "Critical", "color": "red" } } }
          ]
        }
      },
      "options": { "graphMode": "none", "textMode": "auto", "colorMode": "background", "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "title": "Risk Guardrails",
      "description": "Are safety controls blocking trades? Green = no recent blocks. Yellow/Red = trades are being stopped by the governance system.",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 11, "y": 2 },
      "targets": [
        {
          "expr": "increase(trading_governance_blocks_total[15m])",
          "legendFormat": "blocks",
          "refId": "A",
          "instant": true
        }
      ],
      "fieldConfig": {
        "defaults": {
          "thresholds": {
            "steps": [
              { "value": null, "color": "green" },
              { "value": 1, "color": "yellow" },
              { "value": 5, "color": "red" }
            ]
          },
          "mappings": [
            { "type": "range", "options": { "from": 0, "to": 0.5, "result": { "text": "All Clear", "color": "green" } } },
            { "type": "range", "options": { "from": 0.5, "to": 5, "result": { "text": "Trades Blocked", "color": "yellow" } } },
            { "type": "range", "options": { "from": 5, "to": 999999, "result": { "text": "Many Blocks", "color": "red" } } }
          ]
        }
      },
      "options": { "graphMode": "none", "textMode": "auto", "colorMode": "background", "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "title": "Data Feed",
      "description": "Is market data flowing? Shows the stalest data feed. Green = data is fresh (<30s). Yellow = slightly delayed. Red = stale data (>60s).",
      "type": "stat",
      "gridPos": { "h": 4, "w": 5, "x": 15, "y": 2 },
      "targets": [
        {
          "expr": "max(trading_data_staleness_seconds)",
          "legendFormat": "staleness",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "thresholds": {
            "steps": [
              { "value": null, "color": "green" },
              { "value": 30, "color": "yellow" },
              { "value": 60, "color": "red" }
            ]
          },
          "mappings": [
            { "type": "range", "options": { "from": 0, "to": 30, "result": { "text": "Live", "color": "green" } } },
            { "type": "range", "options": { "from": 30, "to": 60, "result": { "text": "Delayed", "color": "yellow" } } },
            { "type": "range", "options": { "from": 60, "to": 999999, "result": { "text": "Stale", "color": "red" } } }
          ]
        }
      },
      "options": { "graphMode": "none", "textMode": "auto", "colorMode": "background", "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "title": "Trading Mode",
      "description": "Current operating mode: Live (real money), Paper (simulated), or Backtest (historical replay).",
      "type": "stat",
      "gridPos": { "h": 4, "w": 4, "x": 20, "y": 2 },
      "targets": [
        {
          "expr": "trading_system_info",
          "legendFormat": "{{mode}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "mappings": [
            { "type": "value", "options": { "1": { "text": "RUNNING", "color": "green" } } }
          ]
        }
      },
      "options": { "graphMode": "none", "textMode": "name", "colorMode": "background", "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "title": "",
      "type": "text",
      "gridPos": { "h": 2, "w": 24, "x": 0, "y": 6 },
      "options": { "content": "# Key Numbers", "mode": "markdown" }
    },
    {
      "title": "Today's Profit / Loss",
      "description": "How much the portfolio gained or lost today. Green = positive. Red = negative.",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 8 },
      "targets": [
        {
          "expr": "trading_daily_pnl",
          "legendFormat": "daily_pnl",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "currencyUSD",
          "thresholds": {
            "steps": [
              { "value": null, "color": "red" },
              { "value": 0, "color": "green" }
            ]
          }
        }
      },
      "options": { "graphMode": "area", "textMode": "auto", "colorMode": "value", "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "title": "Portfolio Value",
      "description": "Total account value right now, including all open positions.",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 8 },
      "targets": [
        {
          "expr": "trading_equity",
          "legendFormat": "equity",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": { "unit": "currencyUSD" }
      },
      "options": { "graphMode": "area", "textMode": "auto", "colorMode": "value", "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "title": "Gross Exposure",
      "description": "Total dollar value of all open positions (gross). This is the combined notional value of all positions currently deployed.",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 12, "y": 8 },
      "targets": [
        {
          "expr": "trading_gross_exposure",
          "legendFormat": "exposure",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": { "unit": "currencyUSD" }
      },
      "options": { "graphMode": "none", "textMode": "auto", "colorMode": "value", "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "title": "Active Trades",
      "description": "Number of trades currently open across all strategies.",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 18, "y": 8 },
      "targets": [
        {
          "expr": "trading_journal_open_trades",
          "legendFormat": "open",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "thresholds": {
            "steps": [
              { "value": null, "color": "blue" }
            ]
          }
        }
      },
      "options": { "graphMode": "none", "textMode": "auto", "colorMode": "value", "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "title": "",
      "type": "text",
      "gridPos": { "h": 2, "w": 24, "x": 0, "y": 12 },
      "options": { "content": "# Portfolio Value Over Time", "mode": "markdown" }
    },
    {
      "title": "Portfolio Value Over Time",
      "description": "Your total account value plotted over time. An upward trend means the strategies are making money overall.",
      "type": "timeseries",
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 14 },
      "targets": [
        {
          "expr": "trading_equity",
          "legendFormat": "Portfolio Value",
          "refId": "A"
        },
        {
          "expr": "trading_daily_pnl",
          "legendFormat": "Today's P&L",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "currencyUSD",
          "custom": {
            "drawStyle": "line",
            "lineWidth": 2,
            "fillOpacity": 10,
            "showPoints": "never"
          }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "Today's P&L" },
            "properties": [
              { "id": "custom.drawStyle", "value": "bars" },
              { "id": "custom.fillOpacity", "value": 50 },
              { "id": "custom.lineWidth", "value": 0 },
              { "id": "color", "value": { "mode": "fixed", "fixedColor": "semi-dark-blue" } }
            ]
          }
        ]
      }
    },
    {
      "title": "",
      "type": "text",
      "gridPos": { "h": 2, "w": 24, "x": 0, "y": 24 },
      "options": { "content": "# Strategy Scorecard", "mode": "markdown" }
    },
    {
      "title": "Strategy Win Rates",
      "description": "What percentage of each strategy's trades are profitable. Above 50% (green) is good. Below 40% (red) needs attention.",
      "type": "bargauge",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 26 },
      "targets": [
        {
          "expr": "trading_journal_win_rate",
          "legendFormat": "{{strategy_id}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percentunit",
          "min": 0,
          "max": 1,
          "thresholds": {
            "steps": [
              { "value": null, "color": "red" },
              { "value": 0.40, "color": "yellow" },
              { "value": 0.50, "color": "green" }
            ]
          }
        }
      },
      "options": {
        "orientation": "horizontal",
        "displayMode": "gradient",
        "showUnfilled": true,
        "reduceOptions": { "calcs": ["lastNotNull"] }
      }
    },
    {
      "title": "Average Profit per Trade",
      "description": "How much each strategy makes (or loses) per trade on average. Positive (green) = profitable. Negative (red) = losing money.",
      "type": "bargauge",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 26 },
      "targets": [
        {
          "expr": "trading_journal_expectancy",
          "legendFormat": "{{strategy_id}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "currencyUSD",
          "thresholds": {
            "steps": [
              { "value": null, "color": "red" },
              { "value": 0, "color": "green" }
            ]
          }
        }
      },
      "options": {
        "orientation": "horizontal",
        "displayMode": "gradient",
        "showUnfilled": true,
        "reduceOptions": { "calcs": ["lastNotNull"] }
      }
    },
    {
      "title": "",
      "type": "text",
      "gridPos": { "h": 2, "w": 24, "x": 0, "y": 34 },
      "options": { "content": "# Recent Safety Events", "mode": "markdown" }
    },
    {
      "title": "Blocked Trades (Last Hour)",
      "description": "Trades that were stopped by the safety system in the last hour. Shows why each trade was blocked and which strategy tried to place it.",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 36 },
      "targets": [
        {
          "expr": "increase(trading_governance_blocks_total[1h])",
          "legendFormat": "{{strategy_id}}: {{reason}}",
          "refId": "A",
          "instant": false
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "custom": {
            "drawStyle": "bars",
            "fillOpacity": 80,
            "stacking": { "mode": "normal" }
          },
          "color": { "mode": "palette-classic" }
        }
      }
    },
    {
      "title": "Strategy Health",
      "description": "Overall health rating for each strategy. 1.0 = perfect health. Below 0.7 = needs attention. Below 0.4 = critical. Based on recent performance and behavior.",
      "type": "bargauge",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 36 },
      "targets": [
        {
          "expr": "trading_strategy_health_score",
          "legendFormat": "{{strategy_id}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "min": 0,
          "max": 1,
          "thresholds": {
            "steps": [
              { "value": null, "color": "red" },
              { "value": 0.4, "color": "yellow" },
              { "value": 0.7, "color": "green" }
            ]
          }
        }
      },
      "options": {
        "orientation": "horizontal",
        "displayMode": "gradient",
        "showUnfilled": true,
        "reduceOptions": { "calcs": ["lastNotNull"] }
      }
    },
    {
      "title": "",
      "type": "text",
      "gridPos": { "h": 2, "w": 24, "x": 0, "y": 44 },
      "options": { "content": "# Open Positions", "mode": "markdown" }
    },
    {
      "title": "Current Positions by Symbol",
      "description": "All currently open positions. Shows the dollar size of each position and whether it is long or short.",
      "type": "table",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 46 },
      "targets": [
        {
          "expr": "trading_position_size",
          "legendFormat": "{{symbol}} ({{side}})",
          "refId": "A",
          "instant": true,
          "format": "table"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "currencyUSD",
          "thresholds": {
            "steps": [
              { "value": null, "color": "text" }
            ]
          }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "symbol" },
            "properties": [
              { "id": "custom.width", "value": 140 }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "side" },
            "properties": [
              { "id": "custom.width", "value": 80 },
              { "id": "mappings", "value": [
                { "type": "value", "options": { "long": { "text": "LONG", "color": "green" }, "short": { "text": "SHORT", "color": "red" } } }
              ] }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "Time" },
            "properties": [
              { "id": "custom.hidden", "value": true }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "__name__" },
            "properties": [
              { "id": "custom.hidden", "value": true }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "instance" },
            "properties": [
              { "id": "custom.hidden", "value": true }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "job" },
            "properties": [
              { "id": "custom.hidden", "value": true }
            ]
          }
        ]
      },
      "transformations": [
        {
          "id": "sortBy",
          "options": { "sort": [{ "field": "Value", "desc": true }] }
        }
      ]
    },
    {
      "title": "Unrealized P&L by Position",
      "description": "How much each open position is currently up or down. Green = profitable. Red = losing money.",
      "type": "bargauge",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 46 },
      "targets": [
        {
          "expr": "trading_unrealized_pnl",
          "legendFormat": "{{symbol}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "currencyUSD",
          "thresholds": {
            "steps": [
              { "value": null, "color": "red" },
              { "value": 0, "color": "green" }
            ]
          }
        }
      },
      "options": {
        "orientation": "horizontal",
        "displayMode": "gradient",
        "showUnfilled": true,
        "reduceOptions": { "calcs": ["lastNotNull"] }
      }
    },
    {
      "title": "",
      "type": "text",
      "gridPos": { "h": 3, "w": 24, "x": 0, "y": 54 },
      "options": {
        "content": "### Deep Dives\n\n| | | | | |\n|---|---|---|---|---|\n| [Strategy Performance →](/d/strategy-performance) | [Risk & Governance →](/d/risk-governance) | [System Health →](/d/system-health) | [Strategy Reference Guide →](/d/strategy-reference) | [Live Narration →](/d/narration-live) |",
        "mode": "markdown"
      }
    }
  ],
  "schemaVersion": 39,
  "tags": ["trading", "overview"],
  "templating": { "list": [] },
  "time": { "from": "now-1h", "to": "now" },
  "refresh": "10s",
  "title": "Trading Overview",
  "uid": "trading-overview"
}
