# ===================================================================
# Backtest mode configuration
# ===================================================================

mode = "backtest"

[backtest]
start_date = "2024-01-01"
end_date = "2024-06-30"
initial_capital = 100_000.0
slippage_model = "volatility_based"
slippage_bps = 5.0
fee_maker = 0.0002
fee_taker = 0.0004
funding_enabled = true
partial_fills = true
latency_ms = 50
random_seed = 42
data_dir = "data/historical"
input_timeframe = "5m"            # Aggregate 1m candles to 5m for less noise

[symbols]
symbols = [
    "BTC/USDT",
    "ETH/USDT",
    "SOL/USDT",
    "XRP/USDT",
    "BNB/USDT",
    "DOGE/USDT",
    "TRX/USDT",
    "SUI/USDT",
    "ADA/USDT",
    "AAVE/USDT",
    "ZEC/USDT",
    "PEPE/USDT",
]

# ===================================================================
# ORIGINAL STRATEGIES
# ===================================================================

[[strategies]]
strategy_id = "trend_following"
enabled = true

[strategies.params]
fast_ema = 12                        # Optimizer: 12 (unchanged)
slow_ema = 21                        # Optimizer: 21 (was 26) — tighter trend window
adx_threshold = 30                   # Optimizer: 30 (was 25) — require strongest trends
atr_multiplier = 3.0                 # Optimizer: 3.0 (was 2.5) — wider stops, fewer whipsaws
min_confidence = 0.5                 # Adjusted: 0.5 (optimizer suggested 0.3 but overtrades)
signal_cooldown_minutes = 720        # Keep 12h — 60min caused overtrading on out-of-sample

[[strategies]]
strategy_id = "mean_reversion"
enabled = false               # Disabled: only 2 trades across all test periods, effectively inactive

[strategies.params]
bb_period = 20
bb_std = 2.5                  # Wider bands = more extreme signals only
rsi_oversold = 20             # Very oversold only
rsi_overbought = 80           # Very overbought only
require_range_regime = false   # Regime detector not active in backtest
mean_reversion_score_threshold = 0.5
min_confidence = 0.65
signal_cooldown_minutes = 720

[[strategies]]
strategy_id = "breakout"
enabled = true

[strategies.params]
donchian_period = 20
volume_confirmation_multiplier = 1.5  # Require stronger volume
min_confidence = 0.65
signal_cooldown_minutes = 720

[[strategies]]
strategy_id = "funding_arb"
enabled = false               # Disabled: no funding data in historical backtest

[strategies.params]
funding_threshold = 0.0001
position_size_pct = 0.05
signal_cooldown_minutes = 720

# ===================================================================
# CMT PLAYBOOK STRATEGIES
# ===================================================================

[[strategies]]
strategy_id = "multi_tf_ma"
enabled = true

[strategies.params]
fast_ema = 50                        # Optimizer: unchanged
slow_ema = 200                       # Optimizer: unchanged
pullback_ema = 21                    # Optimizer: 21 (unchanged)
adx_entry = 15                       # Optimizer: 15 (was 20) — catch trends earlier
adx_exit = 15
atr_multiplier = 2.5                 # Optimizer: 2.5 — wider stops
min_confidence = 0.7                 # Optimizer: 0.7 (was 0.65) — higher quality signals
signal_cooldown_minutes = 720        # Optimizer: 720 (unchanged)

[[strategies]]
strategy_id = "rsi_divergence"
enabled = true

[strategies.params]
rsi_oversold = 35
rsi_overbought = 65
lookback = 50
divergence_bars = 5
min_confidence = 0.65
signal_cooldown_minutes = 720

[[strategies]]
strategy_id = "stochastic_macd"
enabled = true

[strategies.params]
confluence_window = 5                # Optimizer: 5 (was 3) — stronger confluence needed
volume_gate = 1.2                    # Optimizer: 1.2 (unchanged)
stoch_oversold = 25                  # Optimizer: 25 (was 20) — less extreme
stoch_overbought = 75                # Optimizer: 75 (was 80) — less extreme
atr_multiplier = 1.5                 # Optimizer: 1.5 — tighter stops
min_confidence = 0.7                 # Optimizer: 0.7 (was 0.65) — higher bar
signal_cooldown_minutes = 1440       # Optimizer: 1440 (24h) — very selective

[[strategies]]
strategy_id = "bb_squeeze"
enabled = true

[strategies.params]
squeeze_percentile = 15              # Optimizer: 15 (was 10) — slightly wider squeeze definition
bb_period = 20                       # Unchanged
keltner_ema = 20                     # Unchanged
keltner_mult = 1.5                   # Unchanged
adx_threshold = 15                   # Optimizer: 15 — low bar to catch more squeezes
atr_multiplier = 1.5                 # Optimizer: 1.5 — tighter stops
min_confidence = 0.65                # Optimizer: 0.65 (unchanged)
signal_cooldown_minutes = 720        # Optimizer: 720 (unchanged)

[[strategies]]
strategy_id = "mean_reversion_enhanced"
enabled = false               # Disabled: redundant with mean_reversion

[strategies.params]
bb_period = 20
bb_std = 2.0
time_stop_bars = 10
atr_stop_multiplier = 2.0
min_confidence = 0.65
signal_cooldown_minutes = 720

[[strategies]]
strategy_id = "supply_demand"
enabled = false               # Disabled: consistently worst performer across all test periods

[strategies.params]
min_zone_score = 0.4
require_bos = true
min_confidence = 0.65
signal_cooldown_minutes = 720

[[strategies]]
strategy_id = "fibonacci_confluence"
enabled = false               # Disabled: needs larger price swings, noisy on short TF

[strategies.params]
lookback = 100
min_swing_pct = 0.02
cluster_width = 0.005
min_levels_in_cluster = 3
min_confidence = 0.65
signal_cooldown_minutes = 720

[[strategies]]
strategy_id = "obv_divergence"
enabled = false               # Disabled: OBV divergence too noisy on short timeframes

[strategies.params]
lookback = 50
divergence_bars = 5
min_confidence = 0.65
signal_cooldown_minutes = 720

# ===================================================================
# RISK MANAGEMENT
# ===================================================================

# Conservative risk for backtest
[risk]
max_portfolio_leverage = 1.5
max_single_position_pct = 0.05
max_daily_loss_pct = 0.05
max_drawdown_pct = 0.15

[observability]
log_level = "INFO"
log_format = "console"
decision_audit = true
